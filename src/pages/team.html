<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Partie</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
    <link href="../pages/assets/style/style.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&family=Zen+Dots&display=swap" rel="stylesheet">
    <style>
        button {
            margin: auto;
            padding: 20px;
            min-width: 200px;
            border-radius: 25px;
            background-color: rgb(34, 34, 34);
            color: white;
            border: none;
            background-color: rgb(0, 0, 0);
        }

        button:hover {
            background-color: rgb(0, 0, 255);
            transition: background 0.5s ease-in-out;
        }
    </style>
</head>

<body id="body">
    <nav>
        <ul>
            <li><a href="">MAKE TEAM</a></li>
            <li><a href="">MAKE GAME</a></li>
            <li><a href="">MONITOR GAME</a></li>
            <li><a href="">MONITOR TEAM</a></li>
        </ul>
    </nav>

    <div class="teamDivider">
        <h1>Make a team</h1>
        <h2>Enter an ID: <input type="text" id="inputTeamID"></input></h2>
        <h2>Select members:</h2>
        <select multiple="multiple" id="mySelect">
            <option id="userid1" onclick="toggle('userid1')">firstname lastname</option>
            <option id="userid2" onclick="toggle('userid2')">firstname2 lastname2</option>
            <option id="userid3" onclick="toggle('userid3')">firstname3 lastname3</option>
            <option id="userid4" onclick="toggle('userid4')">firstname4 lastname4</option>

        </select><br>
        <button onclick="goValidate();">OK</button>
    </div>

    <div class="validateBox" id="validateBox">
        <h2>Valdate your choices</h2>
        <b>ID:</b>
        <p id='teamID'></p>
        <b>Members:</b>
        <ul id='teamMembers'></ul>
        <span><button onclick="clearData();">REENTER</button> <button onclick="">SUBMIT</button></span>
    </div>

    <script>
        var selectedTeam = []; //who did they choose

        //open validation window
        function goValidate() {
            //did they enter an ID?
            let idEntered = document.getElementById("inputTeamID").value.trim() !== "" ? true : false;
            console.log(document.getElementById("inputTeamID").value.trim());
            //at least 2 entries in team?
            let teamEntered = selectedTeam.length > 1 ? true : false;
            //if they have all compulsory fields... is there a teamID? have they chosen at least 2 people?
            if (idEntered && teamEntered) {
                document.getElementById("teamID").innerHTML = document.getElementById("inputTeamID").value;
                selectedTeam.forEach(elem => {
                    //try catch to avoid adding duplicate items
                    try {
                        let exists = document.getElementById("confirm" + elem).onclick;
                    }

                    catch (e) {
                        let li = document.createElement("li");
                        li.innerHTML = document.getElementById(elem).value;
                        li.id = "confirm" + elem;
                        document.getElementById("teamMembers").appendChild(li);
                        document.getElementById("validateBox").style.display = "block";
                    }

                });
            }
            //if they have missed some fields
            else {
                let errCode = "0";
                if (!idEntered) {
                    //id blank
                    errCode = errCode + "1";
                }
                if (!teamEntered) {
                    //team too small
                    errCode = errCode + "2";
                }
                makeErrorMessage(errCode);
            }
        }

        function makeErrorMessage(err) {
            closeError();
            let div = document.createElement("div");
            div.className = "errorMessage";
            div.onclick = function() {closeError(); };
            div.id = "error";
            let text;
            switch (err) {
                case "012":
                    text = document.createTextNode("ERROR: ID blank and team must contain at least 2 people");
                    break;
                case "01":
                    text = document.createTextNode("ERROR: ID Blank");
                    break;
                case "02":
                    text = document.createTextNode("ERROR: team must contain at least 2 people");
                    break;
                default:
                    text = document.createTextNode("Unknown error");
                    break;
            }
            div.appendChild(text);
            document.getElementById("body").appendChild(div);
            clearData();
        }

        function closeError() {
            try{
                document.getElementById("body").removeChild(document.getElementById("error"));
            }
            catch(err){
                return;
            }
        }

        //keep track of selected users
        function toggle(userId) {
            if (selectedTeam.includes(userId)) {
                selectedTeam = selectedTeam.filter(function (value, index, arr) {
                    if (value == userId) {
                        return;
                    }
                    return value;
                });
                document.getElementById(userId).style.color = "white"
            }
            else {
                selectedTeam.push(userId);
                document.getElementById(userId).style.color = "yellow";
            }
        }

        function clearData() {
            selectedTeam.forEach(elem => {
                //reset style
                document.getElementById(elem).style.backgroundColor = "black";
            });
            //remove the entered text
            document.getElementById("teamID").innerHTML = "";
            document.getElementById("teamMembers").innerHTML = "";
            //empty array
            selectedTeam = [];
            //hide it
            document.getElementById("validateBox").style.display = "none";
        }
    </script>

</body>

</html>